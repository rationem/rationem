<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/WEB-INF/template.xhtml">
 <ui:define name="title">#{pageTitle.cfg_vatCd_pst}</ui:define>
  <ui:define name="header"></ui:define>
  <ui:define name="content">
   <div class="ui-fluid">

   <h:form id="vatCodePostFrm">


    <p:panelGrid layout="grid"   columns="1" columnClasses="ui-grid-col-2">
     <h:panelGroup class="md-inputfield">
      <p:autoComplete
       id="vatCd" value="#{vatCodePostingBean.selectedVatCode}" dropdown="true" var="varCdV" itemValue="#{varCdV}"
       converter="com.rationem.util.converter.VatCode" itemLabel="#{varCdV.code}" required="true"
       completeMethod="#{vatCodePostingBean.onVatCodeCompComplete}" forceSelection="true" >
      </p:autoComplete>
      <p:outputLabel for="vatCd" value="#{formText.vatCd}"/>

     </h:panelGroup>



    </p:panelGrid>


    <p:dataTable
     id="vatCompTbl" var="vatLstCdV" value="#{vatCodePostingBean.selectedVatCode.vatCodeCompanies}"
     rowKey="#{vatCdLst.company.id}" rows="#{vatCodePostingBean.usrBuff.tblRows}" 
     selection="#{vatCodePostingBean.selectedVatPosting}" selectionMode="single"  emptyMessage="#{validationText.vatCompPostSett}">
     <p:ajax event="contextMenu" />

      <f:facet name="header">
       <h:outputText value="#{formText.vatAccountAssignments}"/>
      </f:facet>
      <p:column width="90" headerText="#{formText.comp}">
       <h:outputText value="#{compVatTbleVar.company.reference} #{compVatTbleVar.company.name} "/>
      </p:column>
      <p:column headerText="#{formText.vatCompVatLiabilityGL}">
       <h:outputText value="#{compVatTbleVar.rateGlAccount.coaAccount.ref} #{compVatTbleVar.rateGlAccount.coaAccount.name}"/>
      </p:column>
      <p:column headerText="#{formText.vatCompIrrecovrableRate}">
       <h:outputText value="#{compVatTbleVar.irrecoverRate}">
        <f:convertNumber type="percent" maxFractionDigits="2" minFractionDigits="2" minIntegerDigits="1"/>
       </h:outputText>
      </p:column> 
      <p:column headerText="#{formText.vatCompWoffIrrecoverable}">
       <p:selectBooleanCheckbox disabled="true" value="#{compVatTbleVar.woffIrrecoverable}"/>
      </p:column>
      <p:column headerText="#{formText.vatNoIrrecLine}">
       <p:selectBooleanCheckbox disabled="true" value="#{compVatTbleVar.noIrrecoverableLine}"/>
      </p:column>
      <p:column headerText="#{formText.vatCompWoGlAccount}">
       <h:outputText rendered="#{compVatTbleVar.woffIrrecoverable}" value="#{compVatTbleVar.chargeGlAccount.coaAccount.ref} #{compVatTbleVar.chargeGlAccount.coaAccount.name}"/>
      </p:column>
      
      <p:column headerText="#{formText.vatCompAccrualGlAccount}">
       <h:outputText value="#{compVatTbleVar.accrualGlAccount.coaAccount.ref} #{compVatTbleVar.accrualGlAccount.coaAccount.name}"/>
      </p:column>
       
     </p:dataTable>
    <p:contextMenu for="vatCodePostFrm:vatCompTbl">
     <p:menuitem value="#{formText.vatAdd}" actionListener="#{vatCodePostingBean.onAddVatPostingDlg}"/>
     <p:menuitem value="#{formText.vatCompEdit}" actionListener="#{vatCodePostingBean.onCompVatRateEditListener()}"/>
     </p:contextMenu>

   </h:form>
    <h:form id="addCompVatRateFrm" >
     <p:dialog id="addDlg" widgetVar="addDlgWv" dynamic="true" modal="true" >
      <f:facet name="header">
       <p:panelGrid id="hdrPg" layout="grid" columns="1" >
        <h:outputText
         id="addDlgHdr"
         value="#{formText.vatCompAddActAssignment} #{vatCodePostingBean.selectedVatCode.code}"/>
        <h:panelGroup>
         <h:outputText value="#{formText.vatFlRateRate}"/>
         <p:spacer width="4"/>
         <h:outputText value="#{vatCodePostingBean.selectedVatCode.rate}">
          <f:convertNumber type="percent" />
         </h:outputText>
        </h:panelGroup>

       </p:panelGrid>

      </f:facet>
     <p:panelGrid id="mainPg" layout="grid" columns="1" columnClasses="ui-grid-col-8"
                  styleClass="ui-noborder">
      <h:panelGroup class="md-inputfield">
       <p:autoComplete 
        id="comp" value="#{vatCodePostingBean.addVatPosting.company}" var="compV" 
        converter="com.rationem.util.converter.CompanyBasic" itemValue="#{compV}" 
        itemLabel="#{compV.reference}" required="true"
        completeMethod="#{vatCodePostingBean.onCompComplete}" dropdown="true">
        <p:column width="25%">
         <h:outputText value="#{compV.reference}"/>
        </p:column>
        <p:column width="75%">
         <h:outputText value="#{compV.name}"/>
        </p:column>
        <p:ajax event="itemSelect" listener="#{vatCodePostingBean.onRateCompSelect}" />
       </p:autoComplete>
       <p:outputLabel for="comp" value="#{formText.comp}" />
      </h:panelGroup>
      <h:panelGroup class="md-inputfield">
       <p:autoComplete
        id="liabGl" value="#{vatCodePostingBean.addVatPosting.rateGlAccount}" var="liabGlV"
        converter="com.rationem.util.converter.FiGlAccountComp" itemValue="#{liabGlV}" 
        completeMethod="#{vatCodePostingBean.onVatLiabGlComplete}" itemLabel="#{liabGlV.coaAccount.ref}"
        dropdown="true" disabled="#{vatCodePostingBean.addVatPosting.company eq null}"/>
       <p:outputLabel for="liabGl" value="#{formText.vatCompVatLiabilityGL}"/>
      </h:panelGroup>
      <p:spacer height="5" />
      <h:panelGroup class="md-inputfield">
       <p:inputText id="addIrrRate" value="#{vatCodePostingBean.addVatPosting.irrecoverRate}">
        <f:convertNumber type="percent"/>
       </p:inputText>
       <p:outputLabel for="addIrrRate" value="#{formText.vatCompIrrecovrableRate}"/>
      </h:panelGroup>
     </p:panelGrid>
     <p:panelGrid
      id="woPg" layout="grid" columns="2" columnClasses="ui-grid-col-10,ui-grid-col-1"
      styleClass="ui-noborder">
      <p:outputLabel for="irrLine" value="#{formText.vatNoIrrecLine}"/>
      <p:selectBooleanCheckbox id="irrLine" value="#{vatCodePostingBean.addVatPosting.noIrrecoverableLine}"/>
      <p:outputLabel for="addWoIrr" value="#{formText.vatCompWoffIrrecoverable}"/>
      <p:selectBooleanCheckbox id="addWoIrr" value="#{vatCodePostingBean.addVatPosting.woffIrrecoverable}">
       <p:ajax listener="#{vatCodePostingBean.onWoAcntCBListener}" />
      </p:selectBooleanCheckbox>

      <h:panelGroup class="md-inputfield">
       <p:autoComplete
        id="woGl" value="#{vatCodePostingBean.addVatPosting.chargeGlAccount}" var="woGlV"
        converter="com.rationem.util.converter.FiGlAccountComp" itemValue="#{woGlV}" size="10"
        completeMethod="#{vatCodePostingBean.onVatLiabGlComplete}"
        itemLabel="#{woGlV.coaAccount.ref}" dropdown="true"
        disabled="#{vatCodePostingBean.addVatPosting.company eq null}"/>
       <p:outputLabel for="woGl" value="#{formText.vatCompWoGlAccount}"/>
      </h:panelGroup>
     </p:panelGrid>
     <p:panelGrid
      id="btnPg" layout="grid" columns="2" columnClasses="ui-grid-col-4,ui-grid-col-4"
      styleClass="ui-noborder">
      <p:commandButton value="#{formText.vatAdd}" icon="ui-icon-check"
                       actionListener="#{vatCodePostingBean.onAddVatPostingDlg}"  />
      <p:commandButton value="#{formText.close}"  icon="ui-icon-close"  actionListener="#{vatCodePostingBean.onAddVatPstCloseDlg}"/>
     </p:panelGrid>

    </p:dialog>
   </h:form>
   <p:dialog header="#{formText.vatCompEditActAssignment}" id="editDlg" widgetVar="editDlgWv" 
              >
     <h:form id="editVatPosting" prependId="false">
     <h:panelGrid id="editPG" columns="2">
      <p:outputLabel for="editVatCompMnu" value="#{formText.comp}"/>
      <p:selectOneMenu id="editVatCompMnu" value="#{vatCodePostingBean.selectedVatPosting.company}" 
                       converter="com.rationem.util.converter.CompanyBasic">
       <f:selectItems value="#{vatCodePostingBean.compList}" var="editCompSel" itemValue="#{editCompSel}"
                      itemLabel="#{editCompSel.reference} #{editCompSel.name}"/>
      </p:selectOneMenu>
      <p:outputLabel for="editVatLiabilGlAc" value="#{formText.vatCompVatLiabilityGL}"/>
      <p:selectOneMenu id="editVatLiabilGlAc" value="#{vatCodePostingBean.selectedVatPosting.rateGlAccount}"
                       converter="com.rationem.util.converter.FiGlAccountComp" 
                       valueChangeListener="#{vatCodePostingBean.onVatRateChangeListener}">
       <p:ajax />
       <f:selectItems value="#{vatCodePostingBean.bsGlAccountList}" var="editRateGlActVar" 
                      itemValue="#{editRateGlActVar}"
                      itemLabel="#{editRateGlActVar.coaAccount.ref} 
                      #{editRateGlActVar.coaAccount.name}"/>
      </p:selectOneMenu>
      <p:outputLabel for="editIrrRate" value="#{formText.vatCompIrrecovrableRate}"/>
      <p:inputText id="editIrrRate" value="#{vatCodePostingBean.selectedVatPosting.irrecoverRate}">
       <f:convertNumber type="percent"/>
      </p:inputText>
      <p:outputLabel for="editWoIrr" value="#{formText.vatCompWoffIrrecoverable}"/>
      <p:selectBooleanCheckbox id="editWoIrr" value="#{vatCodePostingBean.selectedVatPosting.woffIrrecoverable}">
       <p:ajax listener="#{vatCodePostingBean.onWoAcntCBListener}" />
      </p:selectBooleanCheckbox>
      <p:outputPanel id="editNoIrrLineLbl">
       <p:outputLabel for="editNoIrrLine" value="#{formText.vatNoIrrecLine}"
                      rendered="#{vatCodePostingBean.selectedVatPosting.woffIrrecoverable}"/>
      </p:outputPanel>
      <p:outputPanel id="editNoIrrLineCb">
       <p:selectBooleanCheckbox id="editNoIrrLine" 
                                rendered="#{vatCodePostingBean.selectedVatPosting.woffIrrecoverable}"
                                value="#{vatCodePostingBean.selectedVatPosting.noIrrecoverableLine}"/>
      </p:outputPanel>
      <h:panelGroup>
      <p:outputPanel id="editWoGlActOp">
       <p:outputLabel for="editWoAct" value="#{formText.vatCompWoGlAccount}" 
                      rendered="#{vatCodePostingBean.selectedVatPosting.woffIrrecoverable}"/>
      </p:outputPanel>
      </h:panelGroup>
      <h:panelGroup>
       <p:outputPanel id="editWoGlActInptOp">
      <p:selectOneMenu id="editWoAct" value="#{vatCodePostingBean.selectedVatPosting.chargeGlAccount}"
                       rendered="#{vatCodePostingBean.selectedVatPosting.woffIrrecoverable}"
                       var="editWoAct" converter="com.rationem.util.converter.FiGlAccountComp">
       <f:selectItem  itemValue="#{vatCodePostingBean.noWoActSelect}" 
                      itemLabel="#{vatCodePostingBean.noWoActSelect.coaAccount.name}" />
       <f:selectItems var="editWoActSe" value="#{vatCodePostingBean.woGlAccountList}" 
                      itemValue="#{addWoActSe}"
                      itemLabel="#{addWoActSe.coaAccount.ref} #{addWoActSe.coaAccount.name}"/>
      </p:selectOneMenu>
      </p:outputPanel>
      </h:panelGroup>
      
      <p:outputLabel for="editProvnActSel" value="#{formText.vatCompAccrualGlAccount}"/>
      <p:selectOneMenu id="editProvnActSel" value="#{vatCodePostingBean.selectedVatPosting.accrualGlAccount}"
                       converter="com.rationem.util.converter.FiGlAccountComp" 
                       >
       
       <f:selectItems value="#{vatCodePostingBean.bsGlAccountList}" var="editProvGlActVar" 
                      itemValue="#{editProvGlActVar}"
                      itemLabel="#{editProvGlActVar.coaAccount.ref} #{editProvGlActVar.coaAccount.name}"/>
      </p:selectOneMenu>
      </h:panelGrid>
     <h:panelGrid columns="3">
      <p:commandButton value="#{formText.save}" icon="ui-icon-check"
                       action="#{vatCodePostingBean.onUpdateVatPosting}" />
      <p:commandButton value="#{formText.close}" type="button" />
     </h:panelGrid>
     </h:form>
    </p:dialog>
    <p:confirmDialog id="delDlg" widgetVar="delConfVar"  severity="alert" 
                     header="#{formText.vatCompDelHdr}" 
                     message="#{formText.vatCompDelMsg} #{vatCodePostingBean.selectedVatPosting.company.reference}">
     <h:form id="delVatPosting" prependId="false">
     <p:commandButton  id="EditDelBtn" value="#{formText.genDelBtn}" icon="ui-icon-trash"
                       actionListener="#{vatCodePostingBean.onDeleteVatPosting}"
                        
                        />
     <p:commandButton value="#{formText.genCloseBtn}" icon="ui-icon-close" 
                      />
     </h:form>
    </p:confirmDialog>
   </div>

    
    
    
   
  </ui:define>
</ui:composition>


